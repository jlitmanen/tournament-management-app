<div class="container">
    <div class="row">
        <div class="col">
            <select class="form-select" id="selest" name="open" onchange="myFunction()">
                <option value="" disabled selected>Valitse...</option>
                <%  let years = [2022, 2023, 2024, 2025, 2026];
                    years.forEach(function(year) { %>
                    <optgroup label="<%= year %>">
                        <% opens?.forEach(function(open) { %>
                            <% if (open.year === year) { %>
                                <option value='<%= open.id %>|<%= open.name %>|<%= open.active %>|<%= open.ended %>|<%= open.year %>'>
                                    <%= open.name %> <%= open.year %>
                                </option>
                            <% } %>
                        <% }) %>
                    </optgroup>
                <% }) %>
            </select>
            <small id="info" class="form-text text-muted">
                Valitse muokattava, tai jätä tyhjäksi luodaksesi uuden.
            </small>
            <form action="/admin/opens/edit" method="post">
                <input type="hidden" name="id" id="id" />
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <input type="submit" value="Muokkaa tarkemmin"/>
            </form>
        </div>
        <div class="col">
            <form action="/admin/opens" method="post">
                <h2>Muokkaa turnausta</h2>
                <div class="form-group">
                    <label for="name">Nimi:  </label>
                    <input class="form-control" type="text" name="name" id="name" />
                </div>
                <div class="form-group">
                    <label for="year">Vuosi:  </label>
                    <input class="form-control" type="number" name="year" id="year" min="2022" max="2030"/>
                </div>
                <div class="form-group">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="active" name="active" />
                        <label class="form-check-label" for="active">Käynnissä</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="ended" name="ended" />
                        <label class="form-check-label" for="ended">Päätetty</label>
                    </div>
                </div>
                <input type="hidden" name="id" id="id" />
                <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                <input type="submit" value="Tallenna"/>
            </form>
        </div>
    </div>
</div>

<script>
    function myFunction() {
        const words = document.getElementById("selest").value.split('|');
        document.getElementById("id").value = words[0].trim();
        document.getElementById("name").value = words[1].trim();
        document.getElementById("active").checked = words[2].trim() === 'true';
        document.getElementById("ended").checked = words[3].trim() === 'true';
        document.getElementById("year").value = words[4].trim();
    }
</script>